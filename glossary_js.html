<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Glossary</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header>
      <nav>
        <ul class="navbar">
          <li><a href="index.html">Home</a></li>
          <li><a href="catalog.html">Catalog</a></li>
        </ul>
      </nav>
    </header>

    <main>
      <section id="intro">
        <h1>About This Project</h1>
        <p>
          Welcome to the About page! Here you'll find detailed explanations,
          organized tables, and references. Each section is linked for easy
          navigation.
        </p>
      </section>

      <section>
        <h1>Glossary</h1>
        <p>Explore terms and concepts from *The Eye of the World*:</p>

        <details>
          <summary>Aes Sedai</summary>
          <div>
            <p>
              Wielders of the One Power. Since the Time of Madness, all
              surviving Aes Sedai are women. Widely distrusted and feared, even
              hated, they are blamed by many for the Breaking of the World. At
              the same time, few rulers will be without an Aes Sedai advisor.
            </p>
          </div>
        </details>

        <details>
          <summary>Ajah</summary>
          <div>
            <p>
              Societies among the Aes Sedai, to which all Aes Sedai belong. They
              are designated by colors, such as Blue Ajah and Red Ajah, each
              following a specific philosophy of the One Power.
            </p>
          </div>
        </details>

        <details>
          <summary>Rand al'Thor</summary>
          <div>
            <p>
              A young farmer and sheepherder from the Two Rivers. He becomes one
              of the central characters of *The Wheel of Time* series.
            </p>
          </div>
        </details>

        <details>
          <summary>
            Adan, Heran (ay- <strong>DAHN</strong>, <strong>HEH</strong>-ran)
          </summary>
          Governor of Baerlon.
        </details>
      </section>
    </main>

    <footer>
      <p>&copy; 2024 My Project. All rights reserved.</p>
    </footer>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Base URL to prepend
        const baseUrl = "https://wot.fandom.com";

        // Fetch the glossary data from the updated text file
        fetch("glossery.txt")
          .then((response) => response.text())
          .then((data) => {
            // Parse the fetched text into an HTML document
            const parser = new DOMParser();
            const glossaryDoc = parser.parseFromString(data, "text/html");

            // Extract terms and definitions
            const terms = glossaryDoc.querySelectorAll("dt");
            const definitions = glossaryDoc.querySelectorAll("dd");

            // Locate the glossary section in the HTML
            const glossarySection = document.querySelector(
              "main section:nth-of-type(2)"
            );

            // Clear existing content in the glossary section
            glossarySection.innerHTML = `
          <h1>Glossary</h1>
          <p>Explore terms and concepts from *The Eye of the World*:</p>
      `;

            // Initialize a map to group terms by their starting letter
            const glossaryMap = {};

            terms.forEach((term, index) => {
              // Extract the first letter of the term
              const firstLetter = term.textContent.trim()[0].toUpperCase();

              // Initialize the group for this letter if it doesn't exist
              if (!glossaryMap[firstLetter]) {
                glossaryMap[firstLetter] = [];
              }

              // Collect the term and its associated definitions
              let currentDefinitions = [];
              let nextSibling = term.nextElementSibling;

              while (nextSibling && nextSibling.tagName === "DD") {
                currentDefinitions.push(nextSibling.innerHTML);
                nextSibling = nextSibling.nextElementSibling;
              }

              // Add the term and definitions to the group
              glossaryMap[firstLetter].push({
                term: term.innerHTML,
                definitions: currentDefinitions,
              });
            });

            // Render the grouped terms and definitions into the glossary section
            Object.entries(glossaryMap)
              .sort(([a], [b]) => a.localeCompare(b)) // Sort the letters alphabetically
              .forEach(([letter, entries]) => {
                // Create a header for each letter
                const letterHeader = document.createElement("h2");
                letterHeader.textContent = letter;
                glossarySection.appendChild(letterHeader);

                // Add the terms and definitions under this letter
                entries.forEach(({ term, definitions }) => {
                  const details = document.createElement("details");
                  const summary = document.createElement("summary");

                  // Update links inside the term
                  const termElement = document.createElement("div");
                  termElement.innerHTML = term;
                  termElement.querySelectorAll("a").forEach((link) => {
                    if (!link.href.startsWith(baseUrl)) {
                      link.href = baseUrl + link.getAttribute("href");
                    }
                  });
                  summary.innerHTML = termElement.innerHTML;
                  details.appendChild(summary);

                  // Update links inside definitions
                  definitions.forEach((definition) => {
                    const div = document.createElement("div");
                    div.innerHTML = definition;
                    div.querySelectorAll("a").forEach((link) => {
                      if (!link.href.startsWith(baseUrl)) {
                        link.href = baseUrl + link.getAttribute("href");
                      }
                    });
                    details.appendChild(div);
                  });

                  glossarySection.appendChild(details);
                });
              });
          })
          .catch((error) => console.error("Error loading glossary:", error));
      });
    </script>
  </body>
</html>
